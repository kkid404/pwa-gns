<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://sdk.push.express/js/v1.2.0/push-express-sdk.js"></script>

  </head>
  <body>
    <div class="loader-wrapper">
      <span class="loader"></span>
    </div>
    <script>
async function redirect() {
  localStorage.setItem("push", "true");
  const offer = localStorage.getItem("offer");
  if (offer) {
    window.location.replace(offer);
  } else {
    console.error("Offer URL is not set in localStorage.");
  }
}

function checkSubscriptionStatus() {
  const pushStatus = localStorage.getItem("push");
  if (pushStatus === "true") {
    redirect();
  }
}

function delayRedirect() {
  setTimeout(redirect, 3000); // Задержка 4 секунды перед редиректом
}

const firebaseConfig = {
  apiKey: "AIzaSyDqYGCyR6tBHIo_qFsT_DMBSWFTb0VWcUI",
  authDomain: "pwa-main-789be.firebaseapp.com",
  projectId: "pwa-main-789be",
  storageBucket: "pwa-main-789be.appspot.com",
  messagingSenderId: "168938603094",
  appId: "1:168938603094:web:f9b87ce0876be9894131f7",
};

const vapidKey =
  "BODt3gGY1JEVr_bINeTRkEeV0orYR5XpASvtw3-q2i2Ay6QxXAQCeij5W8yYJ0JfQYEGh8vq4MkdzEX9L0E8A48";
const push_express_app_id = localStorage.getItem("appId");
const external_id = localStorage.getItem('subid');
const sw_path = "/";
const redirect_url = localStorage.getItem('offer');
initPushExpressSdk();

// Сначала проверяем статус подписки при загрузке страницы
// checkSubscriptionStatus();

// if ('Notification' in window && 'serviceWorker' in navigator) {
//   initPushExpressSdk();
//   let previousPermission = Notification.permission;

//   const checkPermissionChange = () => {
//     const currentPermission = Notification.permission;
//     if (currentPermission !== previousPermission) {
//       previousPermission = currentPermission;
//       delayRedirect(); // Задержка перед редиректом после изменения разрешения
//     }
//   };

//   // Сразу проверить разрешение после первой инициализации
//   checkPermissionChange();

//   setInterval(checkPermissionChange, 1000);
// } else {
//   redirect(); // Если Notification или serviceWorker не поддерживаются
// }
    </script>
  </body>
</html>
